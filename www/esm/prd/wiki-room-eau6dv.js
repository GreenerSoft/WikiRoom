/*! WikiRoom v1.1.0 | (c) GreenerSoft | https://greenersoft.fr | MIT License */
import{elements as e,createData as t,createEffect as o,untrack as a,map as i}from"Room";import{WikipediaLanguages as r,loadWikipediaLanguage as l,saveWikipediaLanguage as n}from"WikiRoomLanguages";import{loadFavorites as s,saveFavorites as c,isFavorite as u,addFavorite as g,removeFavorite as p,FavoritesContent as d}from"WikiRoomFavorites";const{div:m,nav:v,article:h,header:k,h1:b,h2:R,h3:W,a:f,input:C,button:y,p:w,aside:x,dialog:F,form:L,label:M,select:S,option:H}=e(),P=t("fr"),T=t(!1),E=t([]),I=t(0),O=new Worker(JSON.parse(document.querySelector("script[type=importmap]").textContent).imports.WikiRoomWorker);O.addEventListener("message",(e=>{E.push(...e.data),T.value=!1}));const U=e=>W(e,y({onClick:e=>e.target.closest("dialog").close(),title:"Fermer"},"x")),j=e=>{const t=F({class:"favorites"},U("Favoris"),d()),o=(()=>{const e=S({name:"language"},Object.entries(r).map((([e,t])=>H({value:e,selected:e==P.value},e.toUpperCase()+" - "+t))));return F(U("Réglages"),L({method:"dialog",onSubmit:t=>P.value=e.value},M("Langue des articles de Wikipédia : ",e),y("Enregistrer")))})(),a=(e=>F({class:"about"},U("À propos de WikiRoom"),e))(e);return[x(y({type:"button",onClick:()=>t.showModal(),title:"Favoris"},"Favoris"),y({type:"button",onClick:()=>o.showModal(),title:"Réglages"},"Réglages"),y({type:"button",onClick:()=>a.showModal(),title:"À propos"},"À propos")),t,o,a]},q=e=>{const t=(e,t,o)=>f({href:t,dir:o,target:"_blank",rel:"noopener"},e);return h({style:{backgroundImage:`url(${e.image})`}},m({dir:e.direction},k(t(R({lang:e.language},e.title),e.url,e.direction),m(C({type:"checkbox",name:"favorite",title:"Favori",checked:()=>u(e.pageId),onChange:t=>t.target.checked?g(e):p(e)}),y({type:"button",onClick:()=>navigator.share?navigator.share({url:E[I].url,title:E[I].title}).catch((e=>e)):navigator.clipboard.writeText(E[I].url),title:"Partager"},"Partager"))),w({lang:e.language},e.extract),t("Lire la suite sur Wikipédia →",e.url,"ltr")))};export const WikiRoom=e=>{const t=()=>{T.value=!1,E.length=0,I.value=0,u()},r=()=>{n(P),c()},u=()=>g.scrollTop=I.value*g.clientHeight,g=v({onScroll:({target:e})=>I.value=Math.round(e.scrollTop/e.clientHeight),onResize:u});return s(),l(P),o((()=>a(t)),P),o((()=>{!T.value&&I.value>E.length-20&&(T.value=!0,O.postMessage(P.value))})),m({class:"wikiRoom",onUnmount:r,onPageHide:r},m({class:()=>"bounceLoader"+(T.value&&!E.length?"":" hidden")},m(),m(),m()),i(g,E,q),b({onClick:()=>confirm("Réinitialiser la liste des articles ?")&&t(),title:"Réinitialiser"},"WikiRoom"),j(e))};