/*! WikiRoomFavorites v1.1.0 | (c) GreenerSoft | https://greenersoft.fr | MIT License */
import{elements as e,createData as t,setData as a,getData as r,createEffect as o,untrack as i,map as l}from"Room";const{input:n,ul:c,li:s,img:p,div:u,a:d,h4:g,p:v,button:m}=e(),h=t([]),f=t(""),x=t(0),F="Favourites",y=()=>n({type:"file",accept:"application/json",onChange:e=>{try{e.target.files[0].text().then((e=>h.push(...JSON.parse(e).filter((e=>e.title&&e.pageId&&e.language&&e.direction&&e.image&&e.url&&e.extract&&!isFavorite(e.pageId))))))}catch(t){alert("Format non valide.")}}}).click(),I=()=>d({href:URL.createObjectURL(new Blob([JSON.stringify(r(h),null,2)])),download:"WikiRoom-Favoris.json"}).click(),S=(e,t)=>e.toLocaleLowerCase(t).normalize("NFD").replace(/[\u0300-\u036f]/g,""),b=e=>{const t=t=>S(t,e.language).includes(f);return s({class:()=>t(e.title)||t(e.extract)?(x.value++,""):"hidden"},p({src:e.image,loading:"lazy",alt:e.title}),u({lang:e.language,dir:e.direction},d({href:e.url,target:"_blank",rel:"noopener"},g(e.title)),v(e.extract)),m({type:"button",onClick:t=>removeFavorite(e),title:"Supprimer"},"Supprimer"))};export const loadFavorites=()=>{try{a(h,JSON.parse(localStorage.getItem(F))||h)}catch(e){}};export const saveFavorites=()=>{try{localStorage.setItem(F,JSON.stringify(r(h)))}catch(e){}};export const isFavorite=e=>h.find((t=>t.pageId===e));export const addFavorite=e=>!isFavorite(e.id)&&h.push(e);export const removeFavorite=e=>{let t=h.findIndex((t=>t.pageId===e.pageId));t>=0&&h.splice(t,1)};export const FavoritesContent=()=>(o((()=>i((()=>x.value=0))),f),[n({type:"search",name:"search",placeholder:"Chercher dans les favoris",onInput:e=>f.value=S(e.target.value.trim())}),v((()=>h.length?x.value||!f.value?"":"Aucune correspondance.":"Aucun favori.")),l(c(),h,b),m({type:"button",class:"import",onClick:y,title:"Importer des favoris"},"Importer"),m({type:"button",class:"export",onClick:I,title:"Exporter les favoris"},"Exporter")]);